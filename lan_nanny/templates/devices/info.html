<!-- Device Info -->

{% extends "layout.html" %}

{%block head%}
  <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
{%endblock%}

{% block content %}
  <div class="row">
    <div class="col-lg-6">
      <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
          {%if device.last_seen|online%}
            <i class="fas fa-bolt fa-2x device_info_connect connected_bolt"></i>
          {%endif%}
          {%if device.icon%}<i class="{{device.icon}} fa-2x"></i>{%endif%}{%if device.name%}{{device.name}}{%endif%}</h1>
      </div>
    </div>
    <div class="col-lg-6 text-right">
      <!-- <i class="fas fa-bolt"></i> -->
      <a id="device-favorite" href="#" class="btn btn-warning btn-circle btn-lg">
        <i class="fa"></i>
      </a>
      <a href="/device/edit/{{device.id}}" class="btn btn-primary">Edit</a>
    </div>
  </div>

  <!-- Content Row -->
  <div class="row">
    <!-- Device Info -->
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header -->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-primary">
            Info
          </h6>
        </div>

        <!-- Card Body -->
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped" id="dataTable" width="100%" cellspacing="0">
              <tr>
                <td><b>IP</b></td>
                <td>
                  <code>{{device.ip}}</code>
                </td>
              </tr>
              <tr>
                <td><b>Mac</b></td>
                <td><code>{{device.mac}}</code></td>
              </tr>
              <tr>
                <td><b>Vendor</b></td>
                <td>{{device.vendor}}</td>
              </tr>
              <tr>
                <td><b>Status</b></td>
                {%if device.last_seen|online%}
                  <td>Online</td>
                {%else%}
                  <td>Disconnected</td>
                {%endif%}
              </tr>
              <tr>
                <td><b>Last Seen</b></td>
                <td>{{device.last_seen|time_switch}}</td>
              </tr>
              <tr>
                <td><b>Last Port Scan</b></td>
                <td>
                  {% if device.last_port_scan%}
                    {{device.last_port_scan|time_switch}}
                  {%else%}
                    Never Ran
                  {%endif%}
                </td>
              </tr>
              <tr>
                <td><b>First Seen</b></td>
                <td>{{device.first_seen|pretty_time}}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div><!-- END Device Info -->
    
    {%if g.options['beta-features'].value %}
    <!-- Device Stats -->
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header -->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-primary">
            Stats
          </h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped" id="dataTable" width="100%" cellspacing="0">
              <tr>
                <td>Connectivity last 24 hours</td>
                <td>{{device_over_day['device_online_percent']}}%</td>
              </tr>
              <tr>
                <td>Connectivity last week</td>
                <td>{{device_over_week['device_online_percent']}}%</td>
              </tr>
            </table>
            
          </div>
        </div>
      </div>
    </div><!-- End Device Stats-->
    {%endif%}

    <!-- Device Ports -->
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header -->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-primary">
            Ports
          </h6>
        </div>
        <!-- Card Body -->
        <div class="card-body">
          <div class="table-responsive">
            {%if device.ports%}
              <table class="table table-striped" id="dataTable" width="100%" cellspacing="0">
                <thead>
                  <tr>
                    <td>Port</td>
                    <td>Service</td>
                    <td>Protocol</td>
                    <td>Last Seen</td>
                  </tr>
                </thead>
                {%for port in device.ports%}
                  <tr>
                    <td>
                      <a href="/ports/info/{{port.port.port}}/{{port.port.protocol}}">{{port.port.port}}</a>
                    </td>
                    <td>{{port.port.service}}</td>
                    <td>{{port.port.protocol}}</td>
                    <td>{{port.last_seen|smart_time}}</td>
                  </tr>
                {%endfor%}
              </table>
            {%elif device.port_scan==1%}
              No ports found yet for device.
            {%else%}
              No ports found, enable port scanning for this device.
            {%endif%}
          </div>
        </div>
      </div>
    </div><!-- End Device Ports-->


    {%if g.options['beta-features'].value %}
      {%if alerts%}
        <!-- Device Alerts -->
        <div class="col-xl-6 col-lg-6">
          <div class="card shadow mb-4">
            <!-- Card Header -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
              <h6 class="m-0 font-weight-bold text-primary">
                Alerts
              </h6>
            </div>
            <div class="card-body">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <td></td>
                    <td>Alert Type</td>
                    <td>Last Observed</td>
                  </tr>
                </thead>
                {%for alert in alerts%}
                <tr>
                  <td>
                    {%if alert.active %}
                      blink red active
                    {%else%}
                      static black
                    {%endif%}
                    
                  </td>
                  <td>
                    <a href="/alerts/info/{{alert.id}}">
                      {%if alert.kind == 'new-device'%}
                        New Device
                      {%else%}
                        {{alert.kind}}
                      {%endif%}
                    </a>
                  </td>
                  <td>{{alert.last_observed_ts|smart_time}}</td>
                </tr>
                {%endfor%}
              </table>
            </div>
          </div>
        </div><!-- END Device Alerts -->
      {%endif%}
    {%endif%}

    <!-- Device Options -->
    <div class="col-xl-6 col-lg-6">
      <div class="card shadow mb-4">
        <!-- Card Header -->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-primary">
            Options
          </h6>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label for="port_scan">Port Scan</label>
            <input id="port_scan" data-entity-id="{{device.id}}" class="alert-toggle" type="checkbox" data-toggle="toggle" aria-describedby="portScanHelp">
            <small id="portScanHelp" class="form-text text-muted">Enable port scanning of device.</small>
          </div>

          {%if g.options['beta-features'].value %}
            <div class="form-group">
              <label for="alert_device_offline">Alert Offline</label>
              <input id="alert_device_offline" data-entity-id="{{device.id}}" class="alert-toggle" type="checkbox" data-toggle="toggle" aria-describedby="alertDeviceOfflinedHelp">
              <small id="alertDeviceOfflinedHelp" class="form-text text-muted">Alert when device goes offline.</small>
            </div>
          {%endif%}
         

          <!--
          <div class="form-group">
            <label for="alert_online">Alert Online</label>

            <input id="alert_online" data-entity-id="{{device.id}}" class="alert-toggle alert-nanny" type="checkbox" data-toggle="toggle" aria-describedby="alertOnlineHelp">
            <small id="alertOnlineHelp" class="form-text text-muted">Create an alert when the device comes online.</small>
          </div>

          <div class="form-group">
            <label for="alert_offline">Alert Offline</label>
            <input id="alert_offline" data-entity-id="{{device.id}}" class="alert-toggle" type="checkbox" data-toggle="toggle" aria-describedby="alertOfflineHelp">
            <small id="alertOfflineHelp" class="form-text text-muted">Create an alert when the device goes offline.</small>
          </div>
        -->

        </div>
      </div>
    </div><!-- END Device Options -->

  </div>
{%endblock%}

{%block javascript%}
  <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
  <script type="text/javascript">
    $( document ).ready(function(){
      // $( ".copy" ).each(function( index ) {
      //   $(this).append('<i class="fas fa-copy hidden"></i>');
      // });
      // $('.copy').click(function(){
      //   /* Get the text field */
      //   // var copyText = $(this).text().trim();
      //   $(this).focus();
      //   $(this).select();
      //   document.execCommand('copy');

      //   /* Alert the copied text */
      //   alert("Copied the text");
      // });
      var device_favorite_status = convert_str_bool("{{device.favorite}}");
      register_favorite_button('#device-favorite', device_favorite_status, '/device/favorite/{{device.id}}')

      var device_port_scan_status = convert_str_bool("{{device.port_scan}}");
      register_toggle_ajax(
        '/device/quick-save',
        '#port_scan',
        device_port_scan_status);

      // var device_port_scan_flagged_status = convert_str_bool("{{device.flagged_for_scan}}");
      // register_toggle_ajax(
      //   '/device/quick-save',
      //   '#port_scan_flagged',
      //   device_port_scan_flagged_status);
    });
  </script>
{%endblock%}

<!-- End File: lan-nanny/templates/devices/info.html